<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RoseShop Boutique</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>ğŸ›ï¸ RoseShop Boutique</h1>
  <p>Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø£Ø³Ø¹Ø§Ø± Ù…Ù†Ø§Ø³Ø¨Ø©</p>
</header>

<div class="layout">
  <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØµÙÙŠØ© -->
  <div class="controls">
    <input type="text" id="search" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
    <select id="price-filter">
      <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</option>
      <option value="0-18">â‰¤ 18 D</option>
      <option value="19-30">â‰¥ 19 D</option>
    </select>
    <select id="color-filter">
      <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</option>
      <option value="Noir">Noir</option>
      <option value="Blanc">Blanc</option>
      <option value="Rouge">Rouge</option>
      <option value="Bleu">Bleu</option>
    </select>
    <select id="sort-filter">
      <option value="">ØªØ±ØªÙŠØ¨</option>
      <option value="price-asc">Ø§Ù„Ø³Ø¹Ø± ØªØµØ§Ø¹Ø¯ÙŠ</option>
      <option value="price-desc">Ø§Ù„Ø³Ø¹Ø± ØªÙ†Ø§Ø²Ù„ÙŠ</option>
      <option value="name-asc">Ø§Ù„Ø§Ø³Ù… A â†’ Z</option>
      <option value="name-desc">Ø§Ù„Ø§Ø³Ù… Z â†’ A</option>
    </select>
  </div>

  <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
  <div class="products" id="product-list"></div>

  <!-- Ø§Ù„Ø³Ù„Ø© -->
  <aside class="cart">
    <h2>Ø§Ù„Ø³Ù„Ø©</h2>
    <ul id="cart-items"></ul>
    <div>
      <div><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span> <strong><span id="total">0</span> D</strong></div>
      <div><span>TVA 19%:</span> <strong><span id="tva">0</span> D</strong></div>
      <hr/>
      <div><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span> <strong><span id="grand-total">0</span> D</strong></div>
    </div>
    <button id="checkout">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡</button>
    <button id="clear-cart">Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</button>
  </aside>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø±ÙØ§Ø¡ -->
  <section class="clients">
    <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø±ÙØ§Ø¡</h2>
    <table>
      <thead>
        <tr>
          <th>Ø§Ù„Ø§Ø³Ù…</th>
          <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
          <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
          <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
          <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        </tr>
      </thead>
      <tbody id="clients-list"></tbody>
    </table>
  </section>
</div>

<footer>
  <small>Â©2025 RoseShop Boutique</small>
</footer>

<script>
/* Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
const products = [
  {name:"Emballage Noir", price:18, image:"https://raw.githubusercontent.com/mahdi/roseshop/main/noir.jpg", color:"Noir"},
  {name:"Emballage Blanc", price:18, image:"https://raw.githubusercontent.com/mahdi/roseshop/main/blanc.jpg", color:"Blanc"},
  {name:"Emballage Rouge", price:18, image:"https://raw.githubusercontent.com/mahdi/roseshop/main/rouge.jpg", color:"Rouge"},
  {name:"Emballage Bleu", price:20, image:"https://raw.githubusercontent.com/mahdi/roseshop/main/bleu.jpg", color:"Bleu"}
];

let cart = JSON.parse(localStorage.getItem('cart')) || [];
let total = parseFloat(localStorage.getItem('total')) || 0;

/* Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© */
function addToCart(name, price){
  cart.push({name, price});
  total += price;
  saveCart();
  updateCart();
}

/* ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ù„Ø© */
function updateCart(){
  const cartItems=document.getElementById('cart-items');
  cartItems.innerHTML='';
  cart.forEach((item,index)=>{
    const li=document.createElement('li');
    li.textContent=`${item.name} - ${item.price} D`;
    const removeBtn=document.createElement('button');
    removeBtn.textContent='âŒ';
    removeBtn.onclick=()=>{ removeFromCart(index); };
    li.appendChild(removeBtn);
    cartItems.appendChild(li);
  });
  const tva=total*0.19;
  document.getElementById('total').textContent=total.toFixed(2);
  document.getElementById('tva').textContent=tva.toFixed(2);
  document.getElementById('grand-total').textContent=(total+tva).toFixed(2);
}

/* Ø­Ø°Ù Ø¹Ù†ØµØ± */
function removeFromCart(index){
  total -= cart[index].price;
  cart.splice(index,1);
  saveCart();
  updateCart();
}

/* Ø­ÙØ¸ ÙÙŠ localStorage */
function saveCart(){
  localStorage.setItem('cart',JSON.stringify(cart));
  localStorage.setItem('total',total);
}

/* Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø© */
document.getElementById('clear-cart').addEventListener('click',()=>{
  cart=[]; total=0;
  saveCart(); updateCart();
});

/* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
function displayProducts(list){
  const productList = document.getElementById('product-list');
  productList.innerHTML='';
  list.forEach(p=>{
    const div = document.createElement('div');
    div.className='product';
    div.innerHTML=`
      <img src="${p.image}" alt="${p.name}">
      <h3>${p.name}</h3>
      <p>${p.price} D</p>
      <button onclick="addToCart('${p.name}',${p.price})">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
    `;
    productList.appendChild(div);
  });
}

/* Ø§Ù„ØªØµÙÙŠØ© */
function filterProducts() {
  const searchText = document.getElementById('search').value.toLowerCase();
  const priceVal = document.getElementById('price-filter').value;
  const colorVal = document.getElementById('color-filter').value;
  const sortVal = document.getElementById('sort-filter').value;

  let filtered = products.filter(p => p.name.toLowerCase().includes(searchText));
  if(priceVal){
    const [min,max] = priceVal.split('-').map(Number);
    filtered = filtered.filter(p => p.price >= min && p.price <= max);
  }
  if(colorVal){
    filtered = filtered.filter(p => p.color === colorVal);
  }
  if(sortVal){
    if(sortVal === 'price-asc') filtered.sort((a,b)=>a.price-b.price);
    else if(sortVal === 'price-desc') filtered.sort((a,b)=>b.price-a.price);
    else if(sortVal === 'name-asc') filtered.sort((a,b)=>a.name.localeCompare(b.name));
    else if(sortVal === 'name-desc') filtered.sort((a,b)=>b.name.localeCompare(a.name));
  }

  displayProducts(filtered);
}

document.getElementById('search').addEventListener('input', filterProducts);
document.getElementById('price-filter').addEventListener('change', filterProducts);
document.getElementById('color-filter').addEventListener('change', filterProducts);
document.getElementById('sort-filter').addEventListener('change', filterProducts);

window.onload = ()=>{
  filterProducts();
  updateCart();
};
</script>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDbEHFvX2fzhCwpZZAyGW2IGcudRZ_SV-w",
    authDomain: "roseshop-9471d.firebaseapp.com",
    projectId: "roseshop-9471d",
    storageBucket: "roseshop-9471d.firebasestorage.app",
    messagingSenderId: "291783054639",
    appId: "1:291783054639:web:0628582f9f4f41a8bb3dda",
    measurementId: "G-FP7CWDFGP2"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  /* Ø­ÙØ¸ Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ */
  document.getElementById('checkout').addEventListener('click', async () => {
    if (cart.length === 0) {
      alert("Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©!");
      return;
    }
    const name = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:");
    const phone = prompt("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ:");
    const address = prompt("Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù†Ùƒ:");

    if (!name || !phone || !address) {
      alert("ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù‡Ø§ØªÙ Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†");
      return;
    }

    try {
      await addDoc(collection(db, "clients"), {
        name: name,
        phone: phone,
        address: address,
        cart: cart,
        total: total,
        date: new Date().toISOString()
      });
      alert("âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
      cart = [];
      total = 0;
      saveCart();
      updateCart();
      await loadClients();
    } catch (error) {
      console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ!");
    }
  });

  /* ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø±ÙØ§Ø¡ */
  async function loadClients() {
    const querySnapshot = await getDocs(collection(db, "clients"));
    const list = document.getElementById("clients-list");
    list.innerHTML = "";
    querySnapshot.forEach((doc) => {
      const data = doc.data();
      const tr = document.createElement("tr");
      const date = new Date(data.date).toLocaleString("ar-TN");
      tr.innerHTML = `
        <td>${data.name}</td>
        <td>${data.phone}</td>
        <td>${data.address}</td>
        <td>${data.cart.length}</td>
        <td>${data.total} D</td>
        <td>${date}</td>
      `;
      list.appendChild(tr);
    });
  }

  window.addEventListener("load", loadClients);
</script>

</body>
</html>
