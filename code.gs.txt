function doPost(e) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const data = e.parameter;
  sheet.appendRow([data.name, data.phone, data.product, data.total, new Date()]);
  return ContentService.createTextOutput("تم الحفظ").setMimeType(ContentService.MimeType.TEXT);
}

function doGet(e) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const action = e.parameter.action;
  if (action === "read") {
    const data = sheet.getDataRange().getValues();
    const result = data.slice(1).map(row => ({
      name: row[0], phone: row[1], product: row[2], total: row[3], date: row[4]
    }));
    return ContentService.createTextOutput(JSON.stringify(result))
      .setMimeType(ContentService.MimeType.JSON);
  }
  if (action === "delete") {
    sheet.deleteRow(parseInt(e.parameter.row));
    return ContentService.createTextOutput("Deleted").setMimeType(ContentService.MimeType.TEXT);
  }
  return ContentService.createTextOutput("No action").setMimeType(ContentService.MimeType.TEXT);
}